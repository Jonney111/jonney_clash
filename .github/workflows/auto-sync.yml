name: ğŸ”„ Multi Repo Auto Sync

on:
  #schedule:
    #- cron: '0 3 * * *'  # æ¯å¤©åŒ—äº¬æ—¶é—´ 11:00 è‡ªåŠ¨åŒæ­¥
  #workflow_dispatch:      # å¯æ‰‹åŠ¨è§¦å‘

jobs:
  sync:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        repos:
          # ğŸ‘‡ åœ¨è¿™é‡Œæ·»åŠ ä½ è¦åŒæ­¥çš„ä»“åº“
          - name: fork name               
            fork: your repository          
            upstream: akudamatata/Solara
            branch: main
          # ç¤ºä¾‹ï¼šä½ å¯ä»¥ç»§ç»­æ·»åŠ å…¶ä»–é¡¹ç›®
          # - name: ImmortalWrt
          #   fork: Jonney111/immortalwrt
          #   upstream: immortalwrt/immortalwrt
          #   branch: master

    steps:
      - name: ğŸ” Sync ${{ matrix.repos.name }}
        run: |
          echo "=== ğŸš€ Syncing ${{ matrix.repos.fork }} from ${{ matrix.repos.upstream }} ==="

          git clone https://github.com/${{ matrix.repos.fork }}.git repo
          cd repo

          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git remote add upstream https://github.com/${{ matrix.repos.upstream }}.git
          git fetch upstream

          # ä½¿ç”¨åˆå¹¶æ–¹å¼åŒæ­¥ï¼ˆä¿ç•™ä½ çš„ä¿®æ”¹ï¼‰
          git checkout ${{ matrix.repos.branch }}
          git merge upstream/${{ matrix.repos.branch }} --allow-unrelated-histories -m "ğŸ”„ Sync from upstream" || echo "No changes to merge"

          # æ¨é€å›ä½ è‡ªå·±çš„ä»“åº“
          git push https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ matrix.repos.fork }} ${{ matrix.repos.branch }} || echo "âœ… No new updates"

          echo "=== âœ… Sync completed for ${{ matrix.repos.name }} ==="
